<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Stats • Chamu</title>
  <link rel="stylesheet" href="/assets/site.css"/>
  <style>
    /* minimal helpers; everything else uses your site's .wrap and .card */
    .stats-grid { display:grid; gap:1rem; }
    @media (min-width: 900px) { .stats-grid { grid-template-columns: 1fr 1fr; } }
    .metric { font-size: 2rem; font-weight: 700; line-height: 1.1; }
    .sub { opacity:.75; font-size:.95rem; margin-top:.25rem; }
    .bar { height:10px; background:#e6e6e6; border-radius:999px; overflow:hidden; margin-top:.5rem; }
    .bar > i { display:block; height:100%; background:#2f6feb; width:0%; }
    /* heatmap (GitHub-like) */
    .heatmap { display:grid; grid-auto-flow:column; grid-auto-columns: 12px; gap:3px; align-items:start; }
    .heatmap .col { display:grid; grid-template-rows: repeat(7, 12px); gap:3px; }
    .heatmap .cell { width:12px; height:12px; border-radius:2px; background:#e6e6e6; }
    .lvl-1 { background:#c6e48b; }
    .lvl-2 { background:#7bc96f; }
    .lvl-3 { background:#239a3b; }
    .lvl-4 { background:#196127; }
    .legend { display:flex; align-items:center; gap:.35rem; font-size:.85rem; opacity:.8; margin-top:.5rem; }
    .legend .cell{ width:10px; height:10px; }
  </style>
</head>
<body>
<header class="site-header">
  <nav class="nav">
    <a class="brand" href="/">Chamu</a>
    <div class="menu">
      <a href="/about/">About</a>
      <a href="/resume/">Resume</a>
      <a href="/projects/">Projects</a>
      <a href="/stats/">Stats</a>
      <a href="/contact/">Contact</a>
    </div>
  </nav>
</header>

<main class="wrap">
  <h1>Stats</h1>

  <div class="stats-grid">
    <!-- Site age -->
    <div class="card">
      <h2>Site age</h2>
      <div class="metric" id="siteAge">—</div>
      <div class="sub" id="siteAgeExact">Launched —</div>
    </div>

    <!-- Projects -->
    <div class="card">
      <h2>Projects</h2>
      <div class="metric"><span id="done">0</span>/<span id="total">0</span></div>
      <div class="sub">Completed</div>
      <div class="bar" aria-label="progress"><i id="prog"></i></div>
    </div>

    <!-- Lines of code -->
    <div class="card">
      <h2>Total lines of code</h2>
      <div class="metric" id="loc">—</div>
      <div class="sub">Across tracked repositories</div>
    </div>

    <!-- Contributions heatmap -->
    <div class="card">
      <h2>Contributions</h2>
      <div id="heatmap" class="heatmap" aria-label="Contribution heatmap (last 52 weeks)"></div>
      <div class="legend">
        Less
        <span class="cell"></span>
        <span class="cell lvl-1"></span>
        <span class="cell lvl-2"></span>
        <span class="cell lvl-3"></span>
        <span class="cell lvl-4"></span>
        More
      </div>
      <div class="sub" id="heatmapNote">Last 52 weeks</div>
    </div>
  </div>
</main>

<footer>
  <div class="icons">
    <a class="icon" href="https://github.com/your-username" target="_blank" rel="noopener" aria-label="GitHub">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M12 .5a12 12 0 0 0-3.79 23.4c.6.11.82-.26.82-.58v-2.02c-3.34.73-4.04-1.61-4.04-1.61-.55-1.38-1.34-1.75-1.34-1.75-1.09-.74.08-.73.08-.73 1.2.08 1.83 1.23 1.83 1.23 1.07 1.83 2.8 1.3 3.49.99.11-.78.42-1.3.76-1.6-2.67-.31-5.47-1.33-5.47-5.93 0-1.31.47-2.38 1.23-3.22-.12-.3-.53-1.55.12-3.23 0 0 1.01-.32 3.3 1.23a11.5 11.5 0 0 1 6 0c2.29-1.55 3.3-1.23 3.3-1.23.65 1.68.24 2.93.12 3.23.77.84 1.23 1.91 1.23 3.22 0 4.61-2.81 5.61-5.49 5.92.43.37.81 1.1.81 2.22v3.29c0 .32.21.7.82.58A12 12 0 0 0 12 .5z"/></svg>
    </a>
    <a class="icon" href="https://www.linkedin.com/in/chamurv" target="_blank" rel="noopener" aria-label="LinkedIn">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.86 6 2.5 6S0 4.88 0 3.5C0 2.12 1.12 1 2.5 1S4.98 2.12 4.98 3.5zM.5 8h4V24h-4V8zm7.5 0h3.8v2.2h.05c.53-1 1.84-2.2 3.78-2.2 4.05 0 4.8 2.67 4.8 6.16V24h-4v-7.9c0-1.89-.03-4.32-2.63-4.32-2.63 0-3.03 2.05-3.03 4.18V24h-4V8z"/></svg>
    </a>
    <!-- outlined email icon to match your style -->
    <a class="icon" href="mailto:me@chamu.io" aria-label="Email">
      <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
        <rect x="3" y="5" width="18" height="14" rx="2" ry="2"></rect>
        <polyline points="3 7.5 12 13 21 7.5"></polyline>
      </svg>
    </a>
  </div>
  <div>© <span id="year"></span> Chamu</div>
</footer>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // ===== Configure your launch date here =====
  // Set this to your actual site creation date (ISO format).
  const SITE_CREATED = '2025-01-01'; // ← change me

  // Try to load metrics from /assets/site-stats.json
  // Schema:
  // {
  //   "site_created_at": "2025-01-01",
  //   "projects_total": 12,
  //   "projects_done": 7,
  //   "loc_total": 18543,
  //   "commits_by_date": { "2025-02-03": 2, "2025-02-04": 0, ... } // ISO date → count
  // }
  const STATS_URL = '/assets/site-stats.json';

  const els = {
    siteAge: document.getElementById('siteAge'),
    siteAgeExact: document.getElementById('siteAgeExact'),
    done: document.getElementById('done'),
    total: document.getElementById('total'),
    prog: document.getElementById('prog'),
    loc: document.getElementById('loc'),
    heatmap: document.getElementById('heatmap'),
    heatmapNote: document.getElementById('heatmapNote'),
  };

  function fmtInt(n){ return n.toLocaleString(); }

  function humanDuration(from, to){
    const ms = Math.max(0, to - from);
    const d = Math.floor(ms / (24*3600e3));
    const y = Math.floor(d / 365);
    const m = Math.floor((d % 365) / 30);
    const dd = d % 30;
    return (y? y+'y ' : '') + (m? m+'m ' : '') + dd + 'd';
  }

  function updateAge(createdISO){
    const created = new Date(createdISO || SITE_CREATED);
    const now = new Date();
    els.siteAge.textContent = humanDuration(created, now);
    els.siteAgeExact.textContent = `Launched ${created.toDateString()}`;
  }

  function updateProjects(done, total){
    els.done.textContent = done;
    els.total.textContent = total;
    const pct = total ? Math.min(100, Math.round((done/total)*100)) : 0;
    els.prog.style.width = pct + '%';
    els.prog.title = pct + '%';
  }

  function updateLOC(n){
    els.loc.textContent = isFinite(n) ? fmtInt(n) : '—';
  }

  function buildHeatmap(commitsByDate){
    // build last 52 weeks grid ending today (Sun→Sat rows)
    els.heatmap.innerHTML = '';
    const today = new Date();
    const end = new Date(today.getFullYear(), today.getMonth(), today.getDate());
    const start = new Date(end);
    start.setDate(end.getDate() - 7*52 + 1);

    // normalize map
    const counts = new Map();
    let max = 0;
    if (commitsByDate) {
      for (const [iso, c] of Object.entries(commitsByDate)) {
        counts.set(iso, c|0);
        if ((c|0) > max) max = c|0;
      }
    }
    if (max === 0) max = 1; // avoid div/0

    // Generate columns by week
    const cols = [];
    let cur = new Date(start);
    while (cur <= end){
      // each column = one week
      const weekCol = [];
      for (let i=0;i<7;i++){
        const d = new Date(cur);
        const iso = d.toISOString().slice(0,10);
        const v = counts.get(iso) || 0;
        weekCol.push({ date: iso, v });
        cur.setDate(cur.getDate()+1);
        if (cur > end) break;
      }
      cols.push(weekCol);
    }

    // render
    for (const col of cols){
      const colEl = document.createElement('div');
      colEl.className = 'col';
      // Ensure exactly 7 rows; pad at start if needed
      const pad = 7 - col.length;
      for (let i=0;i<pad;i++){
        const cEl = document.createElement('div');
        cEl.className = 'cell';
        colEl.appendChild(cEl);
      }
      for (const cell of col){
        const cEl = document.createElement('div');
        let lvl = 0;
        const ratio = cell.v / max;
        if (cell.v > 0){
          if (ratio < 0.25) lvl = 1;
          else if (ratio < 0.5) lvl = 2;
          else if (ratio < 0.75) lvl = 3;
          else lvl = 4;
        }
        cEl.className = 'cell ' + (lvl ? ('lvl-' + lvl) : '');
        cEl.title = `${cell.date}: ${cell.v} commit${cell.v===1?'':'s'}`;
        colEl.appendChild(cEl);
      }
      els.heatmap.appendChild(colEl);
    }

    const first = cols.length ? cols[0][0]?.date : null;
    els.heatmapNote.textContent = first
      ? `Last 52 weeks • ${first} → ${end.toISOString().slice(0,10)}`
      : 'Last 52 weeks';
  }

  async function init(){
    // defaults in case JSON is missing
    let data = {
      site_created_at: SITE_CREATED,
      projects_total: 0,
      projects_done: 0,
      loc_total: 0,
      commits_by_date: {} // ISO → count
    };
    try {
      const res = await fetch(STATS_URL, { cache: 'no-store' });
      if (res.ok){
        const json = await res.json();
        data = { ...data, ...json };
      }
    } catch (e) {
      // ignore; use defaults
    }
    updateAge(data.site_created_at);
    updateProjects(data.projects_done|0, data.projects_total|0);
    updateLOC(data.loc_total|0);
    buildHeatmap(data.commits_by_date || {});
  }

  init();
</script>

<!-- Optional: your boids background if you want it on stats too -->
<!-- <script src="/boids-background.js" defer></script> -->
</body>
</html>